<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

# cachify-wrapper

Wraps a function with a caching layer

## Usage

#### Parameters

*   `fn` **FN** source of data (callback-last style function)
*   `storage` **Storage\<K, V>** cache storage (optional, default `InMemoryStorageWrapper`)
*   `options` **[Options](#options)**  (optional, default `{}`)
*   `hasher` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** creates key for KV-storage from `fn` arguments (optional, default `JSON.stringify`)

#### Examples

```javascript
const wrapper = require('cachify-wrapper');
class Storage {
	constructor() {
		this.data = new Map();
	}
	get = (key, cb) => cb(null, this.data.get(key))
	set = (key, value, ttl, cb) => {
		this.data.set(key, value);
		if (ttl > 0) setTimeout(() => this.data.delete(key), ttl);
		cb(null, true);
	}
	del = (key, cb) => cb(null, this.data.delete(key))
}
const storage = new Storage();
let count = 0;
const inc = (a, cb) => cb(null, count += a);
const cached = wrapper(inc, storage, {expire: 100});
setTimeout(() => cached(1, (_error, payload) => console.info(payload)), 0); // Invokes request
setTimeout(() => cached(1, (_error, payload) => console.info(payload)), 100); // Takes cached result
setTimeout(() => cached(1, (_error, payload) => console.info(payload)), 200); // Invokes second request

cached.set(2, 'manual value', 1000, () =>
	cached.get(2, (_, result) => {
		console.info(result);
		cached.del(2, () =>
			cached.get(2, (_, result) => console.info(result)))
	}));
```

Returns **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** wrapped `fn`

### Options

Type: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)

#### Properties

*   `storage` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?**

    *   `storage.timeout` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** max storage response time before considering it as failed, and invoking `fn`
*   `source` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?**

    *   `source.timeout` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** max `fn` response time before considering it as failed
*   `expire` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** time to consider cached data expired \[in milliseconds]
*   `spread` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** expire time spread (prevents simultaneous deletions saved items from storage)
*   `lock` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** lock timeout (prevents simultaneous concurrent invoke of `fn` at initial period)
*   `stale` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** additional ttl for stale data
*   `ttl` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** forced ttl (TimeToLive) for data (useful if storage is using from multiply services with different expire)
*   `retries` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** number of storage requests passes before `fn` call
*   `error` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** ttl for erroneous state cache (prevents frequent call of `fn`)
*   `debug` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** debug activation flag
