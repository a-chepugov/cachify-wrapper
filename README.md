<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

## cachify-wrapper

Wrap function with caching layer

**Parameters**

-   `fn` **[Object][1]** 
-   `cache` **[Object][1]** CacheInterface for KVStorage (must provide set, get & expire methods)
-   `options` **[Object][1]?** 
    -   `options.expire` **([Number][2] \| [Object][1])?** key expire options
        -   `options.expire.ttl` **[Number][2]** cached data ttl (optional, default `Infinity`)
        -   `options.expire.deviation` **[Number][2]** expire deviation (optional, default `options.expire.ttl/100`)
    -   `options.lock` **[Object][1]?** lock similar initial request to data source
        -   `options.lock.timeout` **[Number][2]** lock timeout (optional, default `1000`)
        -   `options.lock.placeholder` **[String][3]** lock placeholder (optional, default `'?'`)
    -   `options.latency` **[Number][2]** time to awaiting responce from source (optional, default `options.lock.timeout`)
    -   `options.retries` **[Number][2]** multiplier for `options.latency` to awaiting response from source before new call (optional, default `3`)
    -   `options.prefix` **[String][3]** prefix for `cache` KVStorage keys (optional, default `''`)
    -   `options.stale` **([Boolean][4] \| [Object][1])?** allow to use a stale data
        -   `options.stale.lock` **[Number][2]** lock timout for updating stale data (optional, default `options.retries*options.latency`)
    -   `options.hasher` **[Function][5]** function for creating key for KV-storage (optional, default `JSON.stringify`)

**Examples**

```javascript
const wrapper = require('cachify-wrapper');
const redis = require('redis');
class RedisCache {
 constructor() {
  const client = redis.createClient();
  this.set = (key, value) => new Promise((resolve, reject) => client.set(key, JSON.stringify(value), (error, value) => error ? reject(error) : resolve(value)));
  this.get = (key) => new Promise((resolve, reject) => client.get(key, (error, value) => error ? reject(error) : resolve(JSON.parse(value))));
  this.expire = (key, expire) => new Promise((resolve, reject) => client.pexpire(key, expire, (error) => error ? reject(error) : resolve()));
 }
}
const cache = new RedisCache();
const sourceFunc = (a) => new Promise((resolve, reject) => setTimeout(() => resolve({data: a}), 2000));
const options = {expire: {ttl: 5000}, lock: {timeout: 5000, placeholder: '???'}, latency: 1000, retries: 3, prefix: '__sourceFunc__:'};
const cachified = wrapper(sourceFunc, cache, options);
cachified('123').then((payload) => console.dir(payload, {colors: true, depth: null}));
setTimeout(() => cachified('123').then((payload) => console.dir(payload, {colors: true, depth: null})), 1500);
setTimeout(() => cachified('123').then((payload) => console.dir(payload, {colors: true, depth: null})), 2100);
```

Returns **[Function][5]** wrapped function

## Installation

npm install --save cachify-wrapper

[1]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[2]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[3]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[4]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[5]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function
